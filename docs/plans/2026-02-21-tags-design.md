# Post Tags & Tag Navigation â€” Design Document

**Date:** 2026-02-21
**Status:** Approved

## Goal

Add tags to each channel post and provide tag-based filtering in the reader sidebar.

## Requirements

- Tags generated by Claude Code (manual one-time generation, not API-based)
- Stored in separate `tags.json` file (does not modify tdl export data)
- Tag filter in reader sidebar: click tag to show only matching posts
- Tags displayed as badges under each post title
- Selected tag persisted in localStorage

## Data Format

**File:** `downloads/<slug>/tags.json`

```json
{
  "9": ["Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ"],
  "11": ["Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ"],
  "154": ["n8n", "claude-code", "Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ"]
}
```

- Key: string post ID
- Value: array of tags (lowercase, hyphenated for multi-word)
- Language: Russian (matches channel content)
- 1-4 tags per post
- Tags reused across posts for consistency
- File committed to git

## Tag Generation Process

1. Claude Code reads all posts from `all-messages.json`
2. Analyzes text content and assigns 1-4 relevant tags per post
3. Reuses tags across posts for consistency (e.g., "n8n" for all N8N-related posts)
4. Saves to `downloads/<slug>/tags.json`
5. For new posts after sync: ask Claude Code to tag only the new ones

## Reader UI Changes

### Sidebar â€” Tag Filter Block (above post list)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¢ÑĞ³Ğ¸:           â”‚
â”‚ [Ğ²ÑĞµ]           â”‚
â”‚ [n8n Â·12]       â”‚
â”‚ [claude Â·8]     â”‚
â”‚ [Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·. Â·15]â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ #9           â”‚
â”‚  âœ“ #11 ğŸ¥       â”‚
â”‚    #12 ğŸ–¼ NEW   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Tags sorted by post count (descending)
- Each tag shows count: `n8n Â·12`
- Click tag: filters posts in sidebar AND content area (hides non-matching)
- "Ğ²ÑĞµ" button resets filter
- Active tag highlighted
- Tags also displayed as small badges under each post's h2

### Filtering Behavior

- CSS class `.hidden-by-tag` on `<article>` and `.sidebar-item` to hide non-matching posts
- Read counter recalculated considering the active filter (show filtered count)
- Selected tag saved in localStorage (persists across page loads)
- `data-tags` attribute on each post and sidebar item for JS filtering

### Post Content â€” Tag Badges

```html
<article class="post" data-tags="n8n,claude-code,Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ">
  <h2>#154 <span class="post-new-badge">NEW</span></h2>
  <div class="post-tags">
    <span class="tag-badge">n8n</span>
    <span class="tag-badge">claude-code</span>
    <span class="tag-badge">Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ</span>
  </div>
  ...
</article>
```

- Tag badges are clickable (activate tag filter on click)

## Changes to build_reader.py

1. Load `tags.json` if it exists (gracefully handle missing file â€” no tags shown)
2. Add `data-tags` attribute to each post and sidebar item
3. Generate tag badges under post titles
4. Generate tag filter block in sidebar
5. Add CSS for tag badges and filter
6. Add JS for tag filtering, localStorage persistence

## Scope

- v1: Single-select tag filter (one tag at a time, or "all")
- Tags are display-only in posts (no inline editing)
- No tag search/autocomplete
- No tag color coding (all same style)
